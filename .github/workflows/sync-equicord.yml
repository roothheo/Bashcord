name: Sync with Equicord
on:
    schedule:
        - cron: '0 2 * * *'  # Daily at 2 AM UTC
    workflow_dispatch:

env:
    FORCE_COLOR: true

jobs:
    Sync:
        name: Sync with Equicord
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v4
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}

            - name: Setup Git
              run: |
                  git config --global user.name "GitHub Actions"
                  git config --global user.email "actions@github.com"

            - name: Fetch Equicord changes
              run: |
                  git remote add equicord https://github.com/Equicord/Equicord.git
                  git fetch equicord main

            - name: Merge Equicord changes
              run: |
                  # Backup Bashcord customizations
                  mkdir -p backup_bashcord_customizations
                  cp -r src/bashplugins backup_bashcord_customizations/ || true
                  cp -r src/components/WelcomeModal.tsx backup_bashcord_customizations/ || true
                  cp -r src/plugins/_core/settings.tsx backup_bashcord_customizations/ || true

                  # Merge Equicord changes
                  git merge equicord/main --no-edit || true

                  # Restore Bashcord customizations
                  if [ -d "backup_bashcord_customizations/bashplugins" ]; then
                      rm -rf src/bashplugins
                      cp -r backup_bashcord_customizations/bashplugins src/
                  fi
                  
                  if [ -f "backup_bashcord_customizations/WelcomeModal.tsx" ]; then
                      cp backup_bashcord_customizations/WelcomeModal.tsx src/components/
                  fi
                  
                  if [ -f "backup_bashcord_customizations/settings.tsx" ]; then
                      cp backup_bashcord_customizations/settings.tsx src/plugins/_core/
                  fi

            - name: Commit changes
              run: |
                  git add .
                  if ! git diff --staged --quiet; then
                      git commit -m "ðŸ”„ Sync with Equicord $(date +'%Y-%m-%d')"
                      git push origin main
                  else
                      echo "No changes to commit"
                  fi
